/*
* @Author: han.jiang
* @Date:   2017-04-28 21:38:44
* @Last Modified by:   han.jiang
* @Last Modified time: 2017-05-11 11:48:15
*/

SELECT COUNT() FROM JDATA_USER_TBL;
-- 105321
SELECT COUNT() FROM JDATA_PRODUCT_TBL;
-- 24187
SELECT COUNT() FROM JDATA_COMMENT_TBL;
-- 558552
SELECT COUNT() FROM JDATA_ACTION_TBL;
-- 50601736


-- target generation
drop table if exists LABEL_0409_0413;
create table LABEL_0409_0413 as
select
USER_ID,
SKU_ID,
MAX(case when type = 4 then 1 else 0 end) as Y
from (
select *
from JDATA_ACTION_TBL
where 1=1
and time >= date('2016-04-09')
and time <  date('2016-04-13')
and CATE = '8'
)
group by
USER_ID,
SKU_ID;

SELECT COUNT() FROM LABEL_0409_0413 group by Y;
-- 1008 Y=1, 140117 Y=0






-- USER*SKU level signals
drop table if exists USER_SKU_ACTION_0201_0408;
create table USER_SKU_ACTION_0201_0408 as
select
A.USER_ID as USER_ID
,A.SKU_ID as SKU_ID
,SUM(CASE WHEN TYPE = "1" THEN 1 ELSE 0 END) AS USER_SKU_TYPE_1_CNT
,SUM(CASE WHEN TYPE = "2" THEN 1 ELSE 0 END) AS USER_SKU_TYPE_2_CNT
,SUM(CASE WHEN TYPE = "3" THEN 1 ELSE 0 END) AS USER_SKU_TYPE_3_CNT
,SUM(CASE WHEN TYPE = "4" THEN 1 ELSE 0 END) AS USER_SKU_TYPE_4_CNT
,SUM(CASE WHEN TYPE = "5" THEN 1 ELSE 0 END) AS USER_SKU_TYPE_5_CNT
,SUM(CASE WHEN TYPE = "6" THEN 1 ELSE 0 END) AS USER_SKU_TYPE_6_CNT
,SUM(CASE WHEN TYPE = "1" THEN 1 ELSE 0 END)*1.0 / COUNT() AS USER_SKU_TYPE_1_RATE
,SUM(CASE WHEN TYPE = "2" THEN 1 ELSE 0 END)*1.0 / COUNT() AS USER_SKU_TYPE_2_RATE
,SUM(CASE WHEN TYPE = "3" THEN 1 ELSE 0 END)*1.0 / COUNT() AS USER_SKU_TYPE_3_RATE
,SUM(CASE WHEN TYPE = "4" THEN 1 ELSE 0 END)*1.0 / COUNT() AS USER_SKU_TYPE_4_RATE
,SUM(CASE WHEN TYPE = "5" THEN 1 ELSE 0 END)*1.0 / COUNT() AS USER_SKU_TYPE_5_RATE
,SUM(CASE WHEN TYPE = "6" THEN 1 ELSE 0 END)*1.0 / COUNT() AS USER_SKU_TYPE_6_RATE
,SUM(CASE WHEN TYPE = "4" THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "1" THEN 1 ELSE 0 END) AS USER_SKU_TYPE_1_4_RATE
,SUM(CASE WHEN TYPE = "4" THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "2" THEN 1 ELSE 0 END) AS USER_SKU_TYPE_2_4_RATE
,SUM(CASE WHEN TYPE = "4" THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "3" THEN 1 ELSE 0 END) AS USER_SKU_TYPE_3_4_RATE
,SUM(CASE WHEN TYPE = "4" THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "5" THEN 1 ELSE 0 END) AS USER_SKU_TYPE_5_4_RATE
,SUM(CASE WHEN TYPE = "4" THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "6" THEN 1 ELSE 0 END) AS USER_SKU_TYPE_6_4_RATE
,SUM(CASE WHEN TYPE = "1" AND (STRFTIME('%H', TIME) in ('02', '03', '04', '05', '06', '07', '08' )) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_1_02_08_CNT
,SUM(CASE WHEN TYPE = "1" AND (STRFTIME('%H', TIME) in ('09', '10', '11', '12' ))                   THEN 1 ELSE 0 END) AS USER_SKU_TYPE_1_09_12_CNT
,SUM(CASE WHEN TYPE = "1" AND (STRFTIME('%H', TIME) in ('13', '14', '15', '16', '17', '18' ))       THEN 1 ELSE 0 END) AS USER_SKU_TYPE_1_13_18_CNT
,SUM(CASE WHEN TYPE = "1" AND (STRFTIME('%H', TIME) in ('19', '20', '21', '22', '23', '00', '01' )) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_1_19_01_CNT
,SUM(CASE WHEN TYPE = "2" AND (STRFTIME('%H', TIME) in ('02', '03', '04', '05', '06', '07', '08' )) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_2_02_08_CNT
,SUM(CASE WHEN TYPE = "2" AND (STRFTIME('%H', TIME) in ('09', '10', '11', '12' ))                   THEN 1 ELSE 0 END) AS USER_SKU_TYPE_2_09_12_CNT
,SUM(CASE WHEN TYPE = "2" AND (STRFTIME('%H', TIME) in ('13', '14', '15', '16', '17', '18' ))       THEN 1 ELSE 0 END) AS USER_SKU_TYPE_2_13_18_CNT
,SUM(CASE WHEN TYPE = "2" AND (STRFTIME('%H', TIME) in ('19', '20', '21', '22', '23', '00', '01' )) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_2_19_01_CNT
,SUM(CASE WHEN TYPE = "3" AND (STRFTIME('%H', TIME) in ('02', '03', '04', '05', '06', '07', '08' )) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_3_02_08_CNT
,SUM(CASE WHEN TYPE = "3" AND (STRFTIME('%H', TIME) in ('09', '10', '11', '12' ))                   THEN 1 ELSE 0 END) AS USER_SKU_TYPE_3_09_12_CNT
,SUM(CASE WHEN TYPE = "3" AND (STRFTIME('%H', TIME) in ('13', '14', '15', '16', '17', '18' ))       THEN 1 ELSE 0 END) AS USER_SKU_TYPE_3_13_18_CNT
,SUM(CASE WHEN TYPE = "3" AND (STRFTIME('%H', TIME) in ('19', '20', '21', '22', '23', '00', '01' )) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_3_19_01_CNT
,SUM(CASE WHEN TYPE = "4" AND (STRFTIME('%H', TIME) in ('02', '03', '04', '05', '06', '07', '08' )) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_4_02_08_CNT
,SUM(CASE WHEN TYPE = "4" AND (STRFTIME('%H', TIME) in ('09', '10', '11', '12' ))                   THEN 1 ELSE 0 END) AS USER_SKU_TYPE_4_09_12_CNT
,SUM(CASE WHEN TYPE = "4" AND (STRFTIME('%H', TIME) in ('13', '14', '15', '16', '17', '18' ))       THEN 1 ELSE 0 END) AS USER_SKU_TYPE_4_13_18_CNT
,SUM(CASE WHEN TYPE = "4" AND (STRFTIME('%H', TIME) in ('19', '20', '21', '22', '23', '00', '01' )) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_4_19_01_CNT
,SUM(CASE WHEN TYPE = "5" AND (STRFTIME('%H', TIME) in ('02', '03', '04', '05', '06', '07', '08' )) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_5_02_08_CNT
,SUM(CASE WHEN TYPE = "5" AND (STRFTIME('%H', TIME) in ('09', '10', '11', '12' ))                   THEN 1 ELSE 0 END) AS USER_SKU_TYPE_5_09_12_CNT
,SUM(CASE WHEN TYPE = "5" AND (STRFTIME('%H', TIME) in ('13', '14', '15', '16', '17', '18' ))       THEN 1 ELSE 0 END) AS USER_SKU_TYPE_5_13_18_CNT
,SUM(CASE WHEN TYPE = "5" AND (STRFTIME('%H', TIME) in ('19', '20', '21', '22', '23', '00', '01' )) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_5_19_01_CNT
,SUM(CASE WHEN TYPE = "6" AND (STRFTIME('%H', TIME) in ('02', '03', '04', '05', '06', '07', '08' )) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_6_02_08_CNT
,SUM(CASE WHEN TYPE = "6" AND (STRFTIME('%H', TIME) in ('09', '10', '11', '12' ))                   THEN 1 ELSE 0 END) AS USER_SKU_TYPE_6_09_12_CNT
,SUM(CASE WHEN TYPE = "6" AND (STRFTIME('%H', TIME) in ('13', '14', '15', '16', '17', '18' ))       THEN 1 ELSE 0 END) AS USER_SKU_TYPE_6_13_18_CNT
,SUM(CASE WHEN TYPE = "6" AND (STRFTIME('%H', TIME) in ('19', '20', '21', '22', '23', '00', '01' )) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_6_19_01_CNT
,SUM(CASE WHEN TYPE = "1" AND (STRFTIME('%H', TIME) in ('02', '03', '04', '05', '06', '07', '08' )) THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "1" THEN 1 ELSE 0 END) AS USER_SKU_TYPE_1_02_08_RATE
,SUM(CASE WHEN TYPE = "1" AND (STRFTIME('%H', TIME) in ('09', '10', '11', '12' ))                   THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "1" THEN 1 ELSE 0 END) AS USER_SKU_TYPE_1_09_12_RATE
,SUM(CASE WHEN TYPE = "1" AND (STRFTIME('%H', TIME) in ('13', '14', '15', '16', '17', '18' ))       THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "1" THEN 1 ELSE 0 END) AS USER_SKU_TYPE_1_13_18_RATE
,SUM(CASE WHEN TYPE = "1" AND (STRFTIME('%H', TIME) in ('19', '20', '21', '22', '23', '00', '01' )) THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "1" THEN 1 ELSE 0 END) AS USER_SKU_TYPE_1_19_01_RATE
,SUM(CASE WHEN TYPE = "2" AND (STRFTIME('%H', TIME) in ('02', '03', '04', '05', '06', '07', '08' )) THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "2" THEN 1 ELSE 0 END) AS USER_SKU_TYPE_2_02_08_RATE
,SUM(CASE WHEN TYPE = "2" AND (STRFTIME('%H', TIME) in ('09', '10', '11', '12' ))                   THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "2" THEN 1 ELSE 0 END) AS USER_SKU_TYPE_2_09_12_RATE
,SUM(CASE WHEN TYPE = "2" AND (STRFTIME('%H', TIME) in ('13', '14', '15', '16', '17', '18' ))       THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "2" THEN 1 ELSE 0 END) AS USER_SKU_TYPE_2_13_18_RATE
,SUM(CASE WHEN TYPE = "2" AND (STRFTIME('%H', TIME) in ('19', '20', '21', '22', '23', '00', '01' )) THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "2" THEN 1 ELSE 0 END) AS USER_SKU_TYPE_2_19_01_RATE
,SUM(CASE WHEN TYPE = "3" AND (STRFTIME('%H', TIME) in ('02', '03', '04', '05', '06', '07', '08' )) THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "3" THEN 1 ELSE 0 END) AS USER_SKU_TYPE_3_02_08_RATE
,SUM(CASE WHEN TYPE = "3" AND (STRFTIME('%H', TIME) in ('09', '10', '11', '12' ))                   THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "3" THEN 1 ELSE 0 END) AS USER_SKU_TYPE_3_09_12_RATE
,SUM(CASE WHEN TYPE = "3" AND (STRFTIME('%H', TIME) in ('13', '14', '15', '16', '17', '18' ))       THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "3" THEN 1 ELSE 0 END) AS USER_SKU_TYPE_3_13_18_RATE
,SUM(CASE WHEN TYPE = "3" AND (STRFTIME('%H', TIME) in ('19', '20', '21', '22', '23', '00', '01' )) THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "3" THEN 1 ELSE 0 END) AS USER_SKU_TYPE_3_19_01_RATE
,SUM(CASE WHEN TYPE = "4" AND (STRFTIME('%H', TIME) in ('02', '03', '04', '05', '06', '07', '08' )) THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "4" THEN 1 ELSE 0 END) AS USER_SKU_TYPE_4_02_08_RATE
,SUM(CASE WHEN TYPE = "4" AND (STRFTIME('%H', TIME) in ('09', '10', '11', '12' ))                   THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "4" THEN 1 ELSE 0 END) AS USER_SKU_TYPE_4_09_12_RATE
,SUM(CASE WHEN TYPE = "4" AND (STRFTIME('%H', TIME) in ('13', '14', '15', '16', '17', '18' ))       THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "4" THEN 1 ELSE 0 END) AS USER_SKU_TYPE_4_13_18_RATE
,SUM(CASE WHEN TYPE = "4" AND (STRFTIME('%H', TIME) in ('19', '20', '21', '22', '23', '00', '01' )) THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "4" THEN 1 ELSE 0 END) AS USER_SKU_TYPE_4_19_01_RATE
,SUM(CASE WHEN TYPE = "5" AND (STRFTIME('%H', TIME) in ('02', '03', '04', '05', '06', '07', '08' )) THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "5" THEN 1 ELSE 0 END) AS USER_SKU_TYPE_5_02_08_RATE
,SUM(CASE WHEN TYPE = "5" AND (STRFTIME('%H', TIME) in ('09', '10', '11', '12' ))                   THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "5" THEN 1 ELSE 0 END) AS USER_SKU_TYPE_5_09_12_RATE
,SUM(CASE WHEN TYPE = "5" AND (STRFTIME('%H', TIME) in ('13', '14', '15', '16', '17', '18' ))       THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "5" THEN 1 ELSE 0 END) AS USER_SKU_TYPE_5_13_18_RATE
,SUM(CASE WHEN TYPE = "5" AND (STRFTIME('%H', TIME) in ('19', '20', '21', '22', '23', '00', '01' )) THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "5" THEN 1 ELSE 0 END) AS USER_SKU_TYPE_5_19_01_RATE
,SUM(CASE WHEN TYPE = "6" AND (STRFTIME('%H', TIME) in ('02', '03', '04', '05', '06', '07', '08' )) THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "6" THEN 1 ELSE 0 END) AS USER_SKU_TYPE_6_02_08_RATE
,SUM(CASE WHEN TYPE = "6" AND (STRFTIME('%H', TIME) in ('09', '10', '11', '12' ))                   THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "6" THEN 1 ELSE 0 END) AS USER_SKU_TYPE_6_09_12_RATE
,SUM(CASE WHEN TYPE = "6" AND (STRFTIME('%H', TIME) in ('13', '14', '15', '16', '17', '18' ))       THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "6" THEN 1 ELSE 0 END) AS USER_SKU_TYPE_6_13_18_RATE
,SUM(CASE WHEN TYPE = "6" AND (STRFTIME('%H', TIME) in ('19', '20', '21', '22', '23', '00', '01' )) THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "6" THEN 1 ELSE 0 END) AS USER_SKU_TYPE_6_19_01_RATE


,SUM(CASE WHEN TYPE = "1" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_1_CNT_3
,SUM(CASE WHEN TYPE = "2" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_2_CNT_3
,SUM(CASE WHEN TYPE = "3" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_3_CNT_3
,SUM(CASE WHEN TYPE = "4" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_4_CNT_3
,SUM(CASE WHEN TYPE = "5" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_5_CNT_3
,SUM(CASE WHEN TYPE = "6" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_6_CNT_3
,SUM(CASE WHEN TYPE = "1" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) THEN 1 ELSE 0 END)*1.0 / COUNT() AS USER_SKU_TYPE_1_RATE_3
,SUM(CASE WHEN TYPE = "2" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) THEN 1 ELSE 0 END)*1.0 / COUNT() AS USER_SKU_TYPE_2_RATE_3
,SUM(CASE WHEN TYPE = "3" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) THEN 1 ELSE 0 END)*1.0 / COUNT() AS USER_SKU_TYPE_3_RATE_3
,SUM(CASE WHEN TYPE = "4" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) THEN 1 ELSE 0 END)*1.0 / COUNT() AS USER_SKU_TYPE_4_RATE_3
,SUM(CASE WHEN TYPE = "5" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) THEN 1 ELSE 0 END)*1.0 / COUNT() AS USER_SKU_TYPE_5_RATE_3
,SUM(CASE WHEN TYPE = "6" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) THEN 1 ELSE 0 END)*1.0 / COUNT() AS USER_SKU_TYPE_6_RATE_3
,SUM(CASE WHEN TYPE = "4" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "1" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <=3) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_1_4_RATE_3
,SUM(CASE WHEN TYPE = "4" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "2" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <=3) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_2_4_RATE_3
,SUM(CASE WHEN TYPE = "4" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "3" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <=3) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_3_4_RATE_3
,SUM(CASE WHEN TYPE = "4" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "5" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <=3) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_5_4_RATE_3
,SUM(CASE WHEN TYPE = "4" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "6" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <=3) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_6_4_RATE_3

,SUM(CASE WHEN TYPE = "1" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) AND (STRFTIME('%H', TIME) in ('02', '03', '04', '05', '06', '07', '08' )) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_1_02_08_CNT_3
,SUM(CASE WHEN TYPE = "1" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) AND (STRFTIME('%H', TIME) in ('09', '10', '11', '12' ))                   THEN 1 ELSE 0 END) AS USER_SKU_TYPE_1_09_12_CNT_3
,SUM(CASE WHEN TYPE = "1" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) AND (STRFTIME('%H', TIME) in ('13', '14', '15', '16', '17', '18' ))       THEN 1 ELSE 0 END) AS USER_SKU_TYPE_1_13_18_CNT_3
,SUM(CASE WHEN TYPE = "1" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) AND (STRFTIME('%H', TIME) in ('19', '20', '21', '22', '23', '00', '01' )) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_1_19_01_CNT_3
,SUM(CASE WHEN TYPE = "2" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) AND (STRFTIME('%H', TIME) in ('02', '03', '04', '05', '06', '07', '08' )) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_2_02_08_CNT_3
,SUM(CASE WHEN TYPE = "2" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) AND (STRFTIME('%H', TIME) in ('09', '10', '11', '12' ))                   THEN 1 ELSE 0 END) AS USER_SKU_TYPE_2_09_12_CNT_3
,SUM(CASE WHEN TYPE = "2" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) AND (STRFTIME('%H', TIME) in ('13', '14', '15', '16', '17', '18' ))       THEN 1 ELSE 0 END) AS USER_SKU_TYPE_2_13_18_CNT_3
,SUM(CASE WHEN TYPE = "2" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) AND (STRFTIME('%H', TIME) in ('19', '20', '21', '22', '23', '00', '01' )) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_2_19_01_CNT_3
,SUM(CASE WHEN TYPE = "3" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) AND (STRFTIME('%H', TIME) in ('02', '03', '04', '05', '06', '07', '08' )) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_3_02_08_CNT_3
,SUM(CASE WHEN TYPE = "3" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) AND (STRFTIME('%H', TIME) in ('09', '10', '11', '12' ))                   THEN 1 ELSE 0 END) AS USER_SKU_TYPE_3_09_12_CNT_3
,SUM(CASE WHEN TYPE = "3" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) AND (STRFTIME('%H', TIME) in ('13', '14', '15', '16', '17', '18' ))       THEN 1 ELSE 0 END) AS USER_SKU_TYPE_3_13_18_CNT_3
,SUM(CASE WHEN TYPE = "3" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) AND (STRFTIME('%H', TIME) in ('19', '20', '21', '22', '23', '00', '01' )) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_3_19_01_CNT_3
,SUM(CASE WHEN TYPE = "4" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) AND (STRFTIME('%H', TIME) in ('02', '03', '04', '05', '06', '07', '08' )) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_4_02_08_CNT_3
,SUM(CASE WHEN TYPE = "4" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) AND (STRFTIME('%H', TIME) in ('09', '10', '11', '12' ))                   THEN 1 ELSE 0 END) AS USER_SKU_TYPE_4_09_12_CNT_3
,SUM(CASE WHEN TYPE = "4" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) AND (STRFTIME('%H', TIME) in ('13', '14', '15', '16', '17', '18' ))       THEN 1 ELSE 0 END) AS USER_SKU_TYPE_4_13_18_CNT_3
,SUM(CASE WHEN TYPE = "4" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) AND (STRFTIME('%H', TIME) in ('19', '20', '21', '22', '23', '00', '01' )) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_4_19_01_CNT_3
,SUM(CASE WHEN TYPE = "5" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) AND (STRFTIME('%H', TIME) in ('02', '03', '04', '05', '06', '07', '08' )) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_5_02_08_CNT_3
,SUM(CASE WHEN TYPE = "5" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) AND (STRFTIME('%H', TIME) in ('09', '10', '11', '12' ))                   THEN 1 ELSE 0 END) AS USER_SKU_TYPE_5_09_12_CNT_3
,SUM(CASE WHEN TYPE = "5" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) AND (STRFTIME('%H', TIME) in ('13', '14', '15', '16', '17', '18' ))       THEN 1 ELSE 0 END) AS USER_SKU_TYPE_5_13_18_CNT_3
,SUM(CASE WHEN TYPE = "5" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) AND (STRFTIME('%H', TIME) in ('19', '20', '21', '22', '23', '00', '01' )) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_5_19_01_CNT_3
,SUM(CASE WHEN TYPE = "6" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) AND (STRFTIME('%H', TIME) in ('02', '03', '04', '05', '06', '07', '08' )) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_6_02_08_CNT_3
,SUM(CASE WHEN TYPE = "6" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) AND (STRFTIME('%H', TIME) in ('09', '10', '11', '12' ))                   THEN 1 ELSE 0 END) AS USER_SKU_TYPE_6_09_12_CNT_3
,SUM(CASE WHEN TYPE = "6" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) AND (STRFTIME('%H', TIME) in ('13', '14', '15', '16', '17', '18' ))       THEN 1 ELSE 0 END) AS USER_SKU_TYPE_6_13_18_CNT_3
,SUM(CASE WHEN TYPE = "6" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) AND (STRFTIME('%H', TIME) in ('19', '20', '21', '22', '23', '00', '01' )) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_6_19_01_CNT_3
,SUM(CASE WHEN TYPE = "1" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) AND (STRFTIME('%H', TIME) in ('02', '03', '04', '05', '06', '07', '08' )) THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "1" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_1_02_08_RATE_3
,SUM(CASE WHEN TYPE = "1" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) AND (STRFTIME('%H', TIME) in ('09', '10', '11', '12' ))                   THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "1" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_1_09_12_RATE_3
,SUM(CASE WHEN TYPE = "1" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) AND (STRFTIME('%H', TIME) in ('13', '14', '15', '16', '17', '18' ))       THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "1" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_1_13_18_RATE_3
,SUM(CASE WHEN TYPE = "1" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) AND (STRFTIME('%H', TIME) in ('19', '20', '21', '22', '23', '00', '01' )) THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "1" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_1_19_01_RATE_3
,SUM(CASE WHEN TYPE = "2" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) AND (STRFTIME('%H', TIME) in ('02', '03', '04', '05', '06', '07', '08' )) THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "2" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_2_02_08_RATE_3
,SUM(CASE WHEN TYPE = "2" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) AND (STRFTIME('%H', TIME) in ('09', '10', '11', '12' ))                   THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "2" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_2_09_12_RATE_3
,SUM(CASE WHEN TYPE = "2" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) AND (STRFTIME('%H', TIME) in ('13', '14', '15', '16', '17', '18' ))       THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "2" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_2_13_18_RATE_3
,SUM(CASE WHEN TYPE = "2" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) AND (STRFTIME('%H', TIME) in ('19', '20', '21', '22', '23', '00', '01' )) THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "2" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_2_19_01_RATE_3
,SUM(CASE WHEN TYPE = "3" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) AND (STRFTIME('%H', TIME) in ('02', '03', '04', '05', '06', '07', '08' )) THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "3" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_3_02_08_RATE_3
,SUM(CASE WHEN TYPE = "3" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) AND (STRFTIME('%H', TIME) in ('09', '10', '11', '12' ))                   THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "3" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_3_09_12_RATE_3
,SUM(CASE WHEN TYPE = "3" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) AND (STRFTIME('%H', TIME) in ('13', '14', '15', '16', '17', '18' ))       THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "3" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_3_13_18_RATE_3
,SUM(CASE WHEN TYPE = "3" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) AND (STRFTIME('%H', TIME) in ('19', '20', '21', '22', '23', '00', '01' )) THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "3" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_3_19_01_RATE_3
,SUM(CASE WHEN TYPE = "4" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) AND (STRFTIME('%H', TIME) in ('02', '03', '04', '05', '06', '07', '08' )) THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "4" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_4_02_08_RATE_3
,SUM(CASE WHEN TYPE = "4" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) AND (STRFTIME('%H', TIME) in ('09', '10', '11', '12' ))                   THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "4" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_4_09_12_RATE_3
,SUM(CASE WHEN TYPE = "4" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) AND (STRFTIME('%H', TIME) in ('13', '14', '15', '16', '17', '18' ))       THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "4" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_4_13_18_RATE_3
,SUM(CASE WHEN TYPE = "4" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) AND (STRFTIME('%H', TIME) in ('19', '20', '21', '22', '23', '00', '01' )) THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "4" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_4_19_01_RATE_3
,SUM(CASE WHEN TYPE = "5" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) AND (STRFTIME('%H', TIME) in ('02', '03', '04', '05', '06', '07', '08' )) THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "5" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_5_02_08_RATE_3
,SUM(CASE WHEN TYPE = "5" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) AND (STRFTIME('%H', TIME) in ('09', '10', '11', '12' ))                   THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "5" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_5_09_12_RATE_3
,SUM(CASE WHEN TYPE = "5" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) AND (STRFTIME('%H', TIME) in ('13', '14', '15', '16', '17', '18' ))       THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "5" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_5_13_18_RATE_3
,SUM(CASE WHEN TYPE = "5" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) AND (STRFTIME('%H', TIME) in ('19', '20', '21', '22', '23', '00', '01' )) THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "5" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_5_19_01_RATE_3
,SUM(CASE WHEN TYPE = "6" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) AND (STRFTIME('%H', TIME) in ('02', '03', '04', '05', '06', '07', '08' )) THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "6" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_6_02_08_RATE_3
,SUM(CASE WHEN TYPE = "6" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) AND (STRFTIME('%H', TIME) in ('09', '10', '11', '12' ))                   THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "6" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_6_09_12_RATE_3
,SUM(CASE WHEN TYPE = "6" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) AND (STRFTIME('%H', TIME) in ('13', '14', '15', '16', '17', '18' ))       THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "6" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_6_13_18_RATE_3
,SUM(CASE WHEN TYPE = "6" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) AND (STRFTIME('%H', TIME) in ('19', '20', '21', '22', '23', '00', '01' )) THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "6" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 3) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_6_19_01_RATE_3

,SUM(CASE WHEN TYPE = "1" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_1_CNT_7
,SUM(CASE WHEN TYPE = "2" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_2_CNT_7
,SUM(CASE WHEN TYPE = "3" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_3_CNT_7
,SUM(CASE WHEN TYPE = "4" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_4_CNT_7
,SUM(CASE WHEN TYPE = "5" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_5_CNT_7
,SUM(CASE WHEN TYPE = "6" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_6_CNT_7
,SUM(CASE WHEN TYPE = "1" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) THEN 1 ELSE 0 END)*1.0 / COUNT() AS USER_SKU_TYPE_1_RATE_7
,SUM(CASE WHEN TYPE = "2" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) THEN 1 ELSE 0 END)*1.0 / COUNT() AS USER_SKU_TYPE_2_RATE_7
,SUM(CASE WHEN TYPE = "3" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) THEN 1 ELSE 0 END)*1.0 / COUNT() AS USER_SKU_TYPE_3_RATE_7
,SUM(CASE WHEN TYPE = "4" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) THEN 1 ELSE 0 END)*1.0 / COUNT() AS USER_SKU_TYPE_4_RATE_7
,SUM(CASE WHEN TYPE = "5" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) THEN 1 ELSE 0 END)*1.0 / COUNT() AS USER_SKU_TYPE_5_RATE_7
,SUM(CASE WHEN TYPE = "6" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) THEN 1 ELSE 0 END)*1.0 / COUNT() AS USER_SKU_TYPE_6_RATE_7
,SUM(CASE WHEN TYPE = "4" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "1" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <=7) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_1_4_RATE_7
,SUM(CASE WHEN TYPE = "4" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "2" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <=7) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_2_4_RATE_7
,SUM(CASE WHEN TYPE = "4" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "3" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <=7) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_3_4_RATE_7
,SUM(CASE WHEN TYPE = "4" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "5" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <=7) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_5_4_RATE_7
,SUM(CASE WHEN TYPE = "4" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "6" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <=7) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_6_4_RATE_7

,SUM(CASE WHEN TYPE = "1" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) AND (STRFTIME('%H', TIME) in ('02', '03', '04', '05', '06', '07', '08' )) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_1_02_08_CNT_7
,SUM(CASE WHEN TYPE = "1" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) AND (STRFTIME('%H', TIME) in ('09', '10', '11', '12' ))                   THEN 1 ELSE 0 END) AS USER_SKU_TYPE_1_09_12_CNT_7
,SUM(CASE WHEN TYPE = "1" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) AND (STRFTIME('%H', TIME) in ('13', '14', '15', '16', '17', '18' ))       THEN 1 ELSE 0 END) AS USER_SKU_TYPE_1_13_18_CNT_7
,SUM(CASE WHEN TYPE = "1" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) AND (STRFTIME('%H', TIME) in ('19', '20', '21', '22', '23', '00', '01' )) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_1_19_01_CNT_7
,SUM(CASE WHEN TYPE = "2" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) AND (STRFTIME('%H', TIME) in ('02', '03', '04', '05', '06', '07', '08' )) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_2_02_08_CNT_7
,SUM(CASE WHEN TYPE = "2" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) AND (STRFTIME('%H', TIME) in ('09', '10', '11', '12' ))                   THEN 1 ELSE 0 END) AS USER_SKU_TYPE_2_09_12_CNT_7
,SUM(CASE WHEN TYPE = "2" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) AND (STRFTIME('%H', TIME) in ('13', '14', '15', '16', '17', '18' ))       THEN 1 ELSE 0 END) AS USER_SKU_TYPE_2_13_18_CNT_7
,SUM(CASE WHEN TYPE = "2" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) AND (STRFTIME('%H', TIME) in ('19', '20', '21', '22', '23', '00', '01' )) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_2_19_01_CNT_7
,SUM(CASE WHEN TYPE = "3" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) AND (STRFTIME('%H', TIME) in ('02', '03', '04', '05', '06', '07', '08' )) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_3_02_08_CNT_7
,SUM(CASE WHEN TYPE = "3" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) AND (STRFTIME('%H', TIME) in ('09', '10', '11', '12' ))                   THEN 1 ELSE 0 END) AS USER_SKU_TYPE_3_09_12_CNT_7
,SUM(CASE WHEN TYPE = "3" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) AND (STRFTIME('%H', TIME) in ('13', '14', '15', '16', '17', '18' ))       THEN 1 ELSE 0 END) AS USER_SKU_TYPE_3_13_18_CNT_7
,SUM(CASE WHEN TYPE = "3" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) AND (STRFTIME('%H', TIME) in ('19', '20', '21', '22', '23', '00', '01' )) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_3_19_01_CNT_7
,SUM(CASE WHEN TYPE = "4" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) AND (STRFTIME('%H', TIME) in ('02', '03', '04', '05', '06', '07', '08' )) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_4_02_08_CNT_7
,SUM(CASE WHEN TYPE = "4" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) AND (STRFTIME('%H', TIME) in ('09', '10', '11', '12' ))                   THEN 1 ELSE 0 END) AS USER_SKU_TYPE_4_09_12_CNT_7
,SUM(CASE WHEN TYPE = "4" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) AND (STRFTIME('%H', TIME) in ('13', '14', '15', '16', '17', '18' ))       THEN 1 ELSE 0 END) AS USER_SKU_TYPE_4_13_18_CNT_7
,SUM(CASE WHEN TYPE = "4" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) AND (STRFTIME('%H', TIME) in ('19', '20', '21', '22', '23', '00', '01' )) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_4_19_01_CNT_7
,SUM(CASE WHEN TYPE = "5" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) AND (STRFTIME('%H', TIME) in ('02', '03', '04', '05', '06', '07', '08' )) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_5_02_08_CNT_7
,SUM(CASE WHEN TYPE = "5" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) AND (STRFTIME('%H', TIME) in ('09', '10', '11', '12' ))                   THEN 1 ELSE 0 END) AS USER_SKU_TYPE_5_09_12_CNT_7
,SUM(CASE WHEN TYPE = "5" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) AND (STRFTIME('%H', TIME) in ('13', '14', '15', '16', '17', '18' ))       THEN 1 ELSE 0 END) AS USER_SKU_TYPE_5_13_18_CNT_7
,SUM(CASE WHEN TYPE = "5" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) AND (STRFTIME('%H', TIME) in ('19', '20', '21', '22', '23', '00', '01' )) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_5_19_01_CNT_7
,SUM(CASE WHEN TYPE = "6" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) AND (STRFTIME('%H', TIME) in ('02', '03', '04', '05', '06', '07', '08' )) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_6_02_08_CNT_7
,SUM(CASE WHEN TYPE = "6" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) AND (STRFTIME('%H', TIME) in ('09', '10', '11', '12' ))                   THEN 1 ELSE 0 END) AS USER_SKU_TYPE_6_09_12_CNT_7
,SUM(CASE WHEN TYPE = "6" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) AND (STRFTIME('%H', TIME) in ('13', '14', '15', '16', '17', '18' ))       THEN 1 ELSE 0 END) AS USER_SKU_TYPE_6_13_18_CNT_7
,SUM(CASE WHEN TYPE = "6" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) AND (STRFTIME('%H', TIME) in ('19', '20', '21', '22', '23', '00', '01' )) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_6_19_01_CNT_7
,SUM(CASE WHEN TYPE = "1" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) AND (STRFTIME('%H', TIME) in ('02', '03', '04', '05', '06', '07', '08' )) THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "1" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_1_02_08_RATE_7
,SUM(CASE WHEN TYPE = "1" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) AND (STRFTIME('%H', TIME) in ('09', '10', '11', '12' ))                   THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "1" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_1_09_12_RATE_7
,SUM(CASE WHEN TYPE = "1" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) AND (STRFTIME('%H', TIME) in ('13', '14', '15', '16', '17', '18' ))       THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "1" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_1_13_18_RATE_7
,SUM(CASE WHEN TYPE = "1" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) AND (STRFTIME('%H', TIME) in ('19', '20', '21', '22', '23', '00', '01' )) THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "1" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_1_19_01_RATE_7
,SUM(CASE WHEN TYPE = "2" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) AND (STRFTIME('%H', TIME) in ('02', '03', '04', '05', '06', '07', '08' )) THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "2" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_2_02_08_RATE_7
,SUM(CASE WHEN TYPE = "2" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) AND (STRFTIME('%H', TIME) in ('09', '10', '11', '12' ))                   THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "2" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_2_09_12_RATE_7
,SUM(CASE WHEN TYPE = "2" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) AND (STRFTIME('%H', TIME) in ('13', '14', '15', '16', '17', '18' ))       THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "2" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_2_13_18_RATE_7
,SUM(CASE WHEN TYPE = "2" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) AND (STRFTIME('%H', TIME) in ('19', '20', '21', '22', '23', '00', '01' )) THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "2" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_2_19_01_RATE_7
,SUM(CASE WHEN TYPE = "3" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) AND (STRFTIME('%H', TIME) in ('02', '03', '04', '05', '06', '07', '08' )) THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "3" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_3_02_08_RATE_7
,SUM(CASE WHEN TYPE = "3" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) AND (STRFTIME('%H', TIME) in ('09', '10', '11', '12' ))                   THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "3" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_3_09_12_RATE_7
,SUM(CASE WHEN TYPE = "3" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) AND (STRFTIME('%H', TIME) in ('13', '14', '15', '16', '17', '18' ))       THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "3" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_3_13_18_RATE_7
,SUM(CASE WHEN TYPE = "3" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) AND (STRFTIME('%H', TIME) in ('19', '20', '21', '22', '23', '00', '01' )) THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "3" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_3_19_01_RATE_7
,SUM(CASE WHEN TYPE = "4" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) AND (STRFTIME('%H', TIME) in ('02', '03', '04', '05', '06', '07', '08' )) THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "4" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_4_02_08_RATE_7
,SUM(CASE WHEN TYPE = "4" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) AND (STRFTIME('%H', TIME) in ('09', '10', '11', '12' ))                   THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "4" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_4_09_12_RATE_7
,SUM(CASE WHEN TYPE = "4" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) AND (STRFTIME('%H', TIME) in ('13', '14', '15', '16', '17', '18' ))       THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "4" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_4_13_18_RATE_7
,SUM(CASE WHEN TYPE = "4" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) AND (STRFTIME('%H', TIME) in ('19', '20', '21', '22', '23', '00', '01' )) THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "4" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_4_19_01_RATE_7
,SUM(CASE WHEN TYPE = "5" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) AND (STRFTIME('%H', TIME) in ('02', '03', '04', '05', '06', '07', '08' )) THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "5" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_5_02_08_RATE_7
,SUM(CASE WHEN TYPE = "5" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) AND (STRFTIME('%H', TIME) in ('09', '10', '11', '12' ))                   THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "5" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_5_09_12_RATE_7
,SUM(CASE WHEN TYPE = "5" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) AND (STRFTIME('%H', TIME) in ('13', '14', '15', '16', '17', '18' ))       THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "5" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_5_13_18_RATE_7
,SUM(CASE WHEN TYPE = "5" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) AND (STRFTIME('%H', TIME) in ('19', '20', '21', '22', '23', '00', '01' )) THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "5" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_5_19_01_RATE_7
,SUM(CASE WHEN TYPE = "6" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) AND (STRFTIME('%H', TIME) in ('02', '03', '04', '05', '06', '07', '08' )) THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "6" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_6_02_08_RATE_7
,SUM(CASE WHEN TYPE = "6" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) AND (STRFTIME('%H', TIME) in ('09', '10', '11', '12' ))                   THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "6" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_6_09_12_RATE_7
,SUM(CASE WHEN TYPE = "6" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) AND (STRFTIME('%H', TIME) in ('13', '14', '15', '16', '17', '18' ))       THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "6" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_6_13_18_RATE_7
,SUM(CASE WHEN TYPE = "6" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) AND (STRFTIME('%H', TIME) in ('19', '20', '21', '22', '23', '00', '01' )) THEN 1 ELSE 0 END)*1.0 / SUM(CASE WHEN TYPE = "6" AND (JULIANDAY('2016-04-08') - JULIANDAY(TIME) <= 7) THEN 1 ELSE 0 END) AS USER_SKU_TYPE_6_19_01_RATE_7

from JDATA_ACTION_TBL A
inner join
(
select
distinct USER_ID
from LABEL_0409_0413
 ) B
on A.USER_ID = B.USER_ID
where time <= DATE('2016-04-08')
group by A.USER_ID, A.SKU_ID;

select count() from USER_SKU_ACTION_0201_0408;
-- 3421666
-- 1147219


-- model input master generation
drop table if exists MODEL_INPUT_MASTER_0201_0408;
create table as MODEL_INPUT_MASTER_0201_0408 as
select
A.*
,B.*
,C.*
from
LABEL_0409_0413 as A
left join
USER_SKU_ACTION_0201_0408 as B
on (A.USER_ID = B.USER_ID and A.SKU_ID = B.SKU_ID)
left join
SKU_MASTER_0201_0408 as C
on A.SKU_ID = C.SKU_ID
;

select count() from MODEL_INPUT_MASTER_0201_0408;
--


